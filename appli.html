<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Rêves et Cauchemards </title>
  <link rel="stylesheet" type="text/css" href="pixi.css">
</head>
<body>
  <div id="content">
  <div id="play_area"></div>
  </div>
      
  <script src="pixi.js"></script>
      
  <script type="text/javascript">

    let type = "WebGL"
    if(!PIXI.utils.isWebGLSupported()){
      type = "canvas"
    }

    var play_area = document.getElementById('play_area');

    //Define the canvas area
    const app = new PIXI.Application({width: 800, height: 600, backgroundColor: 0x52251C});
    play_area.appendChild(app.view);

    var home_screen = new PIXI.Container();
    app.stage.addChild(home_screen) 
    var main_gallery = new PIXI.Container();
    app.stage.addChild(main_gallery);

    PIXI.loader
      .add('images/spritesheets/player.png')
      .load(setup);

    var sprite;

    function setup(){

      /************************************** Home Screen *********************************/
     
      home_screen.interactive = true;

      //Title Definition
      var basicText = new PIXI.Text('Êtes-vous éveillé ?');
      basicText.interactive = true;
      basicText.buttonMode = true;
      basicText.anchor.set(0.5);
      basicText.x = 400;
      basicText.y = 300;

      home_screen.addChild(basicText);

      /*-------------Functions ------------*/
      basicText.on('pointerdown', function(){
        home_screen.visible = false;
        main_gallery.visible = true;
      })

      /************************************** END Home Screen *********************************/      

      /************************************** Gallery *********************************/
      main_gallery.interactive = true;
      main_gallery.visible = false;

      current_cadre = 0;

      //Cadres definition
      var cadres = [];
      for (var i = 1; i <= 2; i++) {
        let cadre_1 = PIXI.Sprite.fromImage('images/Cadre_1.png');
        cadre_1.interactive = true;
        cadre_1.buttonMode = true;
        cadre_1.anchor.set(0.5);
        cadre_1.width  = 400;
        cadre_1.height = 350;
        cadre_1.x = 400 + (i-1)*800;
        cadre_1.y = 300;

        cadres.push(cadre_1);
        log(cadres);
        main_gallery.addChild(cadre_1);
      }
        
      
      

      //Player Definition
      var player_texture = PIXI.utils.TextureCache["images/spritesheets/player.png"];
      var player_rectangle = new PIXI.Rectangle(128, 128, 128, 128);
      player_texture.frame = player_rectangle;
      var player = new PIXI.Sprite(player_texture);
      player.anchor.set(0.5);
      player.x = 50;
      player.y = 600 - player.height/2 - 32;

      main_gallery.addChild(player);

      //Next Screen Teleport
      var next_screen_teleport = new PIXI.Sprite(player_texture); //This placeholder and needs to be edited
      next_screen_teleport.interactive = true;
      next_screen_teleport.buttonMode = true;
      next_screen_teleport.tint = 0xff0000;
      next_screen_teleport.anchor.set(0.5);
      next_screen_teleport.x = 750;
      next_screen_teleport.y = 600 - next_screen_teleport.height/2 - 32;

      main_gallery.addChild(next_screen_teleport);

      /*-----------Functions ------------*/

      //Move player on cadre1 click
      cadres.forEach(function(cadre){

          cadre.on('pointerdown', function(){
          var player_move_to_cadre = setInterval(function(){
            //If the player is already in front of the painting, we scale it
            if (player.x > 400) {
              var cadre_1_zoom = setInterval(function(){
                //If the frame is at chosen scale, we stop
                if (cadre.scale.x >= 0.8 && cadre.scale.y >= 0.8) {
                  player.alpha = 0;
                  clearInterval(cadre_1_zoom);
                //Else we scale it a bit  
                } else {
                  cadre.scale.x *= 1.01;
                  cadre.scale.y *= 1.01;
                  player.y -= 7; 
                  if (player.y > 400) {
                      player.alpha -= 0.05;    
                  } else {
                    player.rotation += 0.5;
                    player.scale.x -= 0.05;
                    player.scale.y -= 0.05;
                  }
                }
              }, 100 );

              clearInterval(player_move_to_cadre);
            //Else we move the player  
            } else {
              player.x += 10;
              if (player_rectangle.y >= 128*3){
                player_rectangle.y = 0
              } else {
                player_rectangle.y += 128;
              }
              player.texture.frame = player_rectangle;
            }               
          }, 200);
          
        });
      });
      


      //Move player to teleport
      next_screen_teleport.on('pointerdown', function(){
        if (typeof cadres[current_cadre] == 'undefined') { return;}
          var player_to_teleport = setInterval(function(){
            if (cadres[current_cadre].x <= -400 ) {
              current_cadre += 1;

              clearInterval(player_to_teleport);
            } else {
              //animate player
              if (player_rectangle.y >= 128*3){
                player_rectangle.y = 0
              } else {
                player_rectangle.y += 128;
              }
              player.texture.frame = player_rectangle;

              cadres.forEach(function(cadre){
                cadre.x -= 20; 
              });
              
            }               
          }, 200);
      });
      /***************************END Gallery*********************************************************/

    }

    

      
  </script>
 <script src="pixiscript.js"></script>
 <script src="player_move.js"></script>
 
</body>
</html>
